<!DOCTYPE html>
<html lang="en">
<head>
</head>
<body>
  <div class="container">
      <h3 >Recursos turisticos del Peru</h3>
      <div class="row">
          <div class="col xl9">
              <div class="card">
                  <div id="Table" style="width: 100%; height: 500px;"></div>
              </div>
          </div>
          <div class="col xl3">
              <h5>KNN</h5>
              <div class="row">
                  <div class="col s12">
                      <p class="range-field">
                          <input type="range" id="k" min="1" max="10" value="3" />
                          <label for="k">Valor de K para algoritmo</label>
                      </p>
                      <br>
                      <a id="predict">Graficar</a>
                  </div>
              </div>
          </div>
      </div>
  </div>
  <script src='https://cdn.plot.ly/plotly-2.0.0.min.js'></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script type="text/javascript">
      $(document).ready(function () {
        //console.log($('#k').val())
        var recursos = []
        var predictions = []

        $.get("http://localhost:9000/listar")
            .done(function (data) {recursos = data});
        $('#predict').on("click", function () {
            var k = $('#k').val()
            console.log(k)
            drawChart()
        });
        function drawChart() {
              var data = []
              var x = []
              var y = []
              var text = []
              var marker = []
              x["Sin Predecir"] = []
              y["Sin Predecir"] = []
              text["Sin Predecir"] = []
              marker["Sin Predecir"] = { size: 1 }
              for (i = 0; i < recursos.length; i++) {
                        var rec = recursos[i]
                        if (!x[rec.REGION]) {
                            x[rec.REGION] = []
                            y[rec.REGION] = []
                            text[rec.REGION] = []
                            marker[rec.REGION] = { size: 1 }
                        }
                        x[rec.REGION].push(rec.LATITUD)
                        y[rec.REGION].push(rec.LONGITUD)
                        text[rec.REGION].push("Ubicacion: " + rec.REGION + ", " + rec.PROVINCIA + ", " + rec.DISTRITO + ", LA: " + rec.LATITUD + ", LO: " +rec.LONGITUD)
              }

              for (REGION in x) {
                  data.push({
                      x: x[REGION],
                      y: y[REGION],
                      mode: 'markers',
                      type: 'scatter',
                      name: REGION,
                      text: text[REGION],
                      marker: marker[REGION]
                  })
              }

              var layout = {
                  xaxis: {
                      title: { text: 'Longitud' }
                  },
                  yaxis: {
                      title: { text: 'Latitud' }
                  },
                  title: 'Longitud vs Latitud'
              };

              Plotly.newPlot('Table', data, layout);

              $('#loader').hide()
      };
      });

  </script>